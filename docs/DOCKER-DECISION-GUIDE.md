# Docker 리팩토링 의사결정 가이드

## 🎯 논의 포인트

### 1. 구조 선택 (필수 결정)

세 가지 옵션 중 어떤 것을 선택할 것인가?

#### 옵션 A: 루트 중심 (권장) ⭐⭐⭐

```
루트에 Dockerfile, docker-compose.yml 배치
docker/에 설정파일(.env*) 집중
```

**투표 기준**:
- [ ] 표준 Docker 관례 중요
- [ ] 신규팀원 온보딩 간단해야 함
- [ ] IDE 자동 감지 필요 (IntelliJ, VS Code)
- [ ] 가장 일반적인 구조 선호

**선호도**: ⭐ 매우 권장

---

#### 옵션 B: docker/ 중심

```
모든 Docker 파일을 docker/ 디렉토리에 배치
```

**투표 기준**:
- [ ] 모든 Docker 관련 파일이 한 곳에 있기를 원함
- [ ] 프로젝트 루트를 최소화하고 싶음
- [ ] IDE 자동 감지 안 중요 (수동 설정 가능)

**선호도**: ⭐ 준수

---

#### 옵션 C: 계층화 구조

```
docker/build/ 하위 디렉토리로 Dockerfile 분리
```

**투표 기준**:
- [ ] 매우 큰 프로젝트 (여러 서비스)
- [ ] Dockerfile이 여러 개 필요
- [ ] 복잡한 빌드 시스템

**선호도**: ⭐ 비권장 (현재 프로젝트 규모에 비해 과한)

---

### 2. 실행 시기 (우선순위)

#### A. 즉시 (Phase 1-2)

**장점**:
- ✓ 혼동 빠르게 제거
- ✓ 신규팀원 온보딩 개선
- ✓ 실수 방지 (파일 위치 분명)

**단점**:
- ✗ 즉시 작업 필요
- ✗ 테스트 시간 필요

**권장 타이밍**: 지금 (다음 1주일 내)

---

#### B. 점진적 (Phase 1 → 나머지)

**장점**:
- ✓ 위험 최소화
- ✓ 팀원들 적응 시간

**단점**:
- ✗ 과도기간 혼동 가능
- ✗ 오래 걸림

**권장 타이밍**: 비추 (반쪽 개선은 더 혼동)

---

#### C. 나중에 (대규모 리팩토링 시)

**장점**:
- ✓ 지금은 다른 일 집중

**단점**:
- ✗ 계속 문제 발생
- ✗ 나중에 더 복잡해짐

**권장 타이밍**: 비추

---

### 3. 팀원 피드백 반영

각 팀원이 지적한 문제점:

| 팀원 | 지적사항 | 대응책 |
|------|---------|--------|
| 동료1 | "복잡하고 헷갈린다" | 옵션 A로 단순화 |
| 동료2 | "구조가 표준이 아니다" | 루트 중심 구조로 표준화 |
| 신규팀원 | "실수하기 쉽다" | 경고 메시지 추가 + 문서화 |
| 매니저 | "빌드 실패율 높다" | 명확한 구조로 개선 |

---

## 📊 예상 효과 (정량적)

### 시간 절감

| 시나리오 | 현재 | 리팩토링 후 | 절감 |
|---------|------|-----------|------|
| 신규팀원 온보딩 | 30분 | 10분 | 20분 (66%) |
| 구조 이해 후 첫 빌드 | 20분 | 5분 | 15분 (75%) |
| 환경 설정 오류 해결 | 30분 | 10분 | 20분 (66%) |

### 오류 감소

| 오류 유형 | 현재 월간 빈도 | 리팩토링 후 예상 | 감소율 |
|----------|-------------|-----------|--------|
| 잘못된 환경 선택 | 2-3회 | 0회 | 100% |
| 파일 위치 혼동 | 1-2회 | 0회 | 100% |
| Makefile 명령 오류 | 3-4회 | 1회 | 75% |

---

## 🔧 실행 계획 (옵션 A 선택 시)

### 총 소요 시간: ~4-6시간

| Phase | 작업 | 소요시간 | 담당자 | 위험도 |
|-------|------|--------|--------|--------|
| 1 | 파일 정리 | 15분 | 개발자 | 낮음 |
| 2 | docker-compose 통합 | 30분 | 개발자 | 낮음 |
| 3 | 환경 설정 정규화 | 20분 | 개발자 | 낮음 |
| 4 | Makefile 단순화 | 45분 | 개발자 | 중간 |
| 5 | 검증 | 60분 | 개발자 | 중간 |
| 6 | 문서화 | 30분 | 개발자 | 낮음 |
| 7 | 팀원 교육 | 30분 | 리드 | 낮음 |

**병렬 가능**: 5-6은 동시 진행 가능

---

## 🚀 예상 마일스톤

```
Week 1
├─ 월: Phase 1-2 실행 (git commit)
├─ 화: Phase 3-4 실행 + 검증 (git commit)
├─ 수: Phase 5-6 (git commit)
└─ 목: 팀원 교육 + 피드백

완료: 목요일 (4일 소요)
```

---

## 📋 최종 체크리스트

### 의사결정 전 확인

**구조 선택**:
- [ ] 옵션 A (루트 중심) 선택
- [ ] 옵션 B (docker/ 중심) 선택
- [ ] 옵션 C (계층화) 선택

**실행 시기**:
- [ ] 즉시 (다음 1주일)
- [ ] 점진적 (2-3주)
- [ ] 나중에 (미정)

**참석자 확인**:
- [ ] 나 (의사결정자)
- [ ] 동료 (영향받는 사람)
- [ ] 리드/매니저 (승인자)

**추가 고려사항**:
- [ ] 현재 진행 중인 다른 프로젝트 없는가?
- [ ] git history 영향 검토했는가?
- [ ] CI/CD 변경 계획 있는가?

---

## 💬 토론 프롬프트

### 리더에게 할 질문

1. **구조 선택**
   - "옵션 A가 가장 표준적인데, 우리 팀은 이것을 선호하나?"
   - "IDE 자동 감지가 중요한가?"

2. **시기 선택**
   - "다음 1주일 내에 이 작업을 할 여유가 있는가?"
   - "지금 하지 않으면 언제 할 수 있을까?"

3. **팀원 동의**
   - "동료들의 불만이 충분히 반영됐는가?"
   - "신규팀원을 위해 이것이 필요한가?"

4. **위험 평가**
   - "각 Phase의 위험도를 어떻게 생각하는가?"
   - "롤백 계획은 충분한가?"

---

## 📚 참고 자료

프로젝트에 작성된 문서들:

1. **DOCKER-REFACTORING-PLAN.md**
   - 상세한 작업 계획
   - Phase별 체크리스트
   - 주의사항

2. **DOCKER-STRUCTURE-COMPARISON.md**
   - 현재 vs 리팩토링 비교
   - SOLID 원칙 적용 예제
   - 마이그레이션 영향 분석

3. **CLAUDE.md** (이미 작성됨)
   - Docker 빌드 환경 설명

4. **README.md** (이미 작성됨)
   - 사용자 가이드

---

## ❓ FAQ

### Q1. 지금 리팩토링하지 않으면 어떻게 되나?

**A**: 현재 상태 유지
- 신규팀원 온보딩 계속 어려움
- 실수로 인한 빌드 실패 계속 발생
- 기술 부채 증가

---

### Q2. 리팩토링 중에 빌드가 깨지면?

**A**: Phase별로 진행하므로 언제든 롤백 가능
- Phase 1: 파일 정리 (git 커밋) → 문제 시 되돌리기 쉬움
- Phase 2: docker-compose 통합 → 각 단계 검증
- Phase 5: 전체 검증 → 실제 빌드 테스트

---

### Q3. CI/CD(GitHub Actions)는 어떻게?

**A**: 검증 Phase에서 확인
- 경로 변경 없으면 문제 없음
- 혹시 문제 있으면 Actions 파일만 수정

---

### Q4. 팀원들은 언제 알아야 하나?

**A**: 단계별로
- Phase 1-2 후: "구조 정리했어" 공지
- Phase 5 후: "이제 이렇게 써" 가이드 공유
- 교육 세션: 30분 미팅 (make help 데모)

---

### Q5. 옵션 A 선택 후 나중에 다른 옵션으로 바꿀 수 있나?

**A**: 가능하지만 비추
- 옵션 A가 가장 표준적임
- 처음부터 잘 설계하는 게 낫다

---

## 🎬 다음 단계

### 이 회의 후 (오늘)

- [ ] 의사결정 완료 (옵션 선택)
- [ ] 실행 시기 결정
- [ ] 이 문서를 git에 커밋

### 1-2일 내

- [ ] Phase 1 실행 및 테스트
- [ ] 팀원 피드백 수집

### 1주일 내

- [ ] 전체 리팩토링 완료
- [ ] 팀원 교육 실시

### 2주일 후

- [ ] 실제 효과 측정 (오류율, 온보딩 시간)
- [ ] 추가 개선사항 논의

---

## 📞 연락처

리팩토링 중 질문/문제:
- 기술 문제: `#docker` Slack 채널
- 의사결정 변경: 리드/매니저와 협의

---

**최종 결정**: _________________ (옵션 선택)

**실행 시기**: _________________ (시간대 선택)

**승인자**: _________________ (서명)

**날짜**: _________________ (오늘)
